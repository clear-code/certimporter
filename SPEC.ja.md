■証明書インポータ 0.6　仕様


■■概要

本アドオンは、SSL、オブジェクト署名、およびS/MIME用の証明書をFirefoxへ自動的に
インポートする機能を提供する。


■■利用手順

 1. 本アドオンをインストールする。
    * 全ユーザに対して有効にする場合は、Firefoxインストール先の
      「browser」内の「extensions」フォルダに
      「certimporter@clear-code.com」フォルダを作成し、
      XPIファイルの内容を展開して配置する。
      （既定のインストール先であれば
        C:\Program Files\Mozilla Firefox\browser\extensions 内）
    * 特定のユーザに対してのみ有効にする場合は、当該ユーザのプロファイルで起動
      したFirefox上に本アドオンのXPIファイルをドラッグ＆ドロップする。
 2. インポートさせる対象の証明書、および例外設定の定義ファイルを配置する。
    * 全ユーザに対してインポートさせる場合は、Firefoxインストール先の「defaults」
      フォルダ内にファイルを配置する。
      （既定のインストール先であれば
        C:\Program Files\Mozilla Firefox\defaults 内）
    * 特定のユーザに対してのみ有効にする場合は、当該ユーザのユーザプロファイル
      フォルダ直下にファイルを配置する。

以上の手順により、Firefoxの次回起動時に証明書が自動的にインポートされる。


■■制限

 * 本アドオンはDER形式のX509証明書をPEM形式へ変換した証明書のインポートにのみ
   対応する。
 * 本アドオンは、ファイル名の拡張子が「.crt」「.cer」「.pem」である物を
   インポート対象の証明書ファイルとして認識する。それ以外のファイルは無視する。

■■証明書の種類の明示

本アドオンは、インポートした証明書をそれ自身に記載されている通りの種類の物
として登録する。ただし、ルート証明書のフラグが指定されている物については、
ルート証明書としてのみインポートし、他の種類としては認識しない。

証明書に正しいフラグが設定されていない場合などには、設定を用いて証明書の種類を
明示する必要がある。これは以下の要領で行う。

    // 0 = nothing
    // 1 = CA cert
    // 2 = User cert
    // 4 = Email cert
    // 8 = Site cert
    pref("extensions.certimporter.importAs.*", 0); // default
    pref("extensions.certimporter.importAs.mydomain.example.com.pem, 8); // site SSL

この例のように、設定名には証明書のファイル名を含める。


■■セキュリティ例外の自動登録

本アドオンは、インポートした証明書を、すべてのホストに対して恒久的に有効な例外
として扱うよう登録する。そのため、通常、個別のホストに対しセキュリティ例外を
設定する必要はない。

しかしながら、プロキシ自動設定スクリプト（PACファイル）を使用する環境などでは、
すべてのホストに対する例外指定だけではなく、実際の個別のホストに対するセキュリ
ティ例外を明示的に設定しなければならない場合がある。

そのため本アドオンは、セキュリティ例外の定義ファイルを用いたセキュリティ例外の
自動登録機能を有している。

なお、本機能はFirefoxの仕様上、Firefox 10.0以降でのみ有効となる。

■■■書式

本アドオンは、インポート対象の証明書ファイルと同じ位置に置かれた
「（証明書ファイルの名前）.override」という名前のファイルを、セキュリティ例外
の定義ファイルとして認識する。セキュリティ例外の定義ファイルの内容は、以下の
書式である。

----------------------------------------------------------------------
（ホスト名）:（ポート番号）:（セキュリティ例外のフラグ）
----------------------------------------------------------------------

複数のセキュリティ例外を設定する場合は、定義行をスペース、タブ、または改行で
区切って複数記述する。

 * すでにインポート済みの証明書に対するセキュリティ例外を追加する場合は、
   既存の定義行はそのまま残した上で、新たに追加したいセキュリティ例外を後ろに
   書き加える。
 * すでに追加済みのセキュリティ例外についてフラグを変更する場合は、既存の定義
   行を編集する。
 * すでに追加済みのセキュリティ例外を削除させる場合は、セキュリティ例外のフラ
   グを0に設定する。

■■■セキュリティ例外のフラグ

セキュリティ例外のフラグは、以下の定数の組み合わせにより指定する。

 * 1 = 自己署名証明書、不明な認証局によって発行された証明書である旨の警告を
       無視する
 * 2 = 証明書に記載されたホスト名と異なるホストである旨の警告を無視する
 * 4 = 証明書の有効期限が切れている旨の警告を無視する

例えば「証明書に記載されたホスト名と異なるホストで、期限切れの証明書を運用して
いる」場合に対するセキュリティ例外のフラグは、2 + 4 = 「6」である。

ただし、証明書に記載されたホスト名と異なるホストで自己署名証明書を用いるケース
のように、「1」とそれ以外のフラグを組み合わせるケースでは、「1」を除いた残りの
定数の組み合わせのみをフラグとして指定する。（この場合であれば、1 + 2 = 「3」
ではなく、「2」を指定することになる。）

■■■設定例

例えば、https://www.example.com にアクセスした際に「自己署名証明書である」旨の
警告が表示され、https://foo.example.com にアクセスした際に「この証明書は
www.example.comに対してのみ有効である」旨の警告が表示される場合、これらの警告を
表示しないようにするためのセキュリティ例外の定義は以下の通りとなる。

        www.example.com:443:1
        foo.example.com:443:2


■■自動的にインポートした証明書の削除

 * 本アドオンはFirefoxにインポートされた証明書を自動的に削除する機能を持たない。

